<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ - –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–∏–≥–∞ –ú–æ—Å–∫–≤—ã</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        #geolocation-status {
            margin-bottom: 20px;
            font-size: 16px;
            color: #2E8B57;
        }
        #geolocation-status.error {
            color: #FF6347;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-top">
            <a href="https://green-code-moscow.ru/">
                {% load static %}
                <img src="{% static 'images/–†–∏—Å—É–Ω–æ–∫1.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø –ó–µ–ª—ë–Ω–æ–≥–æ –∫–æ–¥–∞ –ú–æ—Å–∫–≤—ã" class="logo">
            </a>
            <div class="address">
                –ú–æ—Å–∫–≤–∞, —É–ª. —É–ª, –¥. 1
            </div>
        </div>
        <hr class="header-separator">
        <h1>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</h1>
    </header>
    
    <nav class="main-nav">
        <ul>
            <li><a href="{% url 'home' %}" class="nav-button">–ì–ª–∞–≤–Ω–∞—è</a></li>
        </ul>
    </nav>

    <section>
        <h2>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ —Ñ–æ—Ç–æ</h2>
        <div id="geolocation-status">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...</div>
        <form id="upload-form" action="upload_handler.php" method="POST" enctype="multipart/form-data">
            <div class="file-upload-wrapper">
                <input type="file" id="photo" name="photo" accept="image/*" style="display:none;">
                <button type="button" class="custom-file-upload" id="select-button">
                    <span class="upload-icon">üìÅ</span> –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                </button>
                <button type="button" class="custom-file-upload" id="capture-button">
                    <span class="upload-icon">üì∑</span> –°–Ω—è—Ç—å —Ñ–æ—Ç–æ
                </button>
            </div>
            <div id="preview" class="preview"></div>
            
            <input type="hidden" id="latitude" name="latitude">
            <input type="hidden" id="longitude" name="longitude">
            
            <button type="submit" class="nav-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </section>
    
    <footer>
        <p>&copy; 2024 –ó–µ–ª—ë–Ω—ã–π –∫–æ–¥ –ú–æ—Å–∫–≤—ã</p>
    </footer>

    <script>
        const photoInput = document.getElementById('photo');
        const preview = document.getElementById('preview');
        const selectButton = document.getElementById('select-button');
        const captureButton = document.getElementById('capture-button');
        const geolocationStatus = document.getElementById('geolocation-status');
        const latitudeInput = document.getElementById('latitude');
        const longitudeInput = document.getElementById('longitude');
        const form = document.getElementById('upload-form');

        selectButton.addEventListener('click', function() {
            photoInput.removeAttribute('capture');
            photoInput.click();
        });

        captureButton.addEventListener('click', function() {
            photoInput.setAttribute('capture', 'environment');
            photoInput.click();
        });

        photoInput.addEventListener('change', function() {
            preview.innerHTML = '';
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = "–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è";
                    img.classList.add('preview-image');
                    preview.appendChild(img);
                }
                reader.readAsDataURL(file);
            }
        });

        window.addEventListener('DOMContentLoaded', (event) => {
            if (navigator.geolocation) {
                console.log("–ó–∞–ø—Ä–æ—Å –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...");
                navigator.geolocation.getCurrentPosition(function(position) {
                    latitudeInput.value = position.coords.latitude;
                    longitudeInput.value = position.coords.longitude;
                    geolocationStatus.textContent = `–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${position.coords.latitude}, ${position.coords.longitude}`;

                    console.log("–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞:", position.coords.latitude, position.coords.longitude);
                }, function(error) {
                    geolocationStatus.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.";
                    geolocationStatus.classList.add('error');
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏:", error);
                });
            } else {
                geolocationStatus.textContent = "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.";
                geolocationStatus.classList.add('error');
                console.error("Geolocation API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —ç—Ç–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.");
            }
        });

        form.addEventListener('submit', function(event) {
            if (!photoInput.files.length) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–Ω–∏–º–∏—Ç–µ —Ñ–æ—Ç–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.");
                event.preventDefault();
                return;
            }

            if (!latitudeInput.value || !longitudeInput.value) {
                const proceed = confirm("–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –±–µ–∑ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö?");
                if (!proceed) {
                    event.preventDefault();
                }
            }
        });
    </script>
</body>
</html>
